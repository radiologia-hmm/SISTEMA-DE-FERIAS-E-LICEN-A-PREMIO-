<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Escolha de Férias - Radiologia 2025</title>
    <style>
        :root{
          --bg:#0f172a;
          --panel:#111827;
          --muted:#9ca3af;
          --text:#f9fafb;
          --primary:#22c55e;
          --primary-600:#16a34a;
          --danger:#ef4444;
          --warning:#f59e0b;
          --card:#0b1020;
          --border:#1f2937;
          --input:#0b1220;
          --accent:#38bdf8;
          --shadow: 0 10px 24px rgba(0,0,0,.35);
        }
        *{box-sizing:border-box}
        body{
          margin:0;
          font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial;
          background: radial-gradient(1200px 600px at 20% 0%, #0c1226 0%, #080b18 35%, var(--bg) 65%) no-repeat, var(--bg);
          color:var(--text);
          min-height:100dvh;
        }
        .container{
          max-width:1100px;
          margin:24px auto;
          padding:0 16px;
        }
        header{
          display:flex;
          flex-direction: column;
          align-items:center;
          justify-content:center;
          margin-bottom:18px;
          text-align: center;
        }
        h1{
          font-size:32px;
          margin:0;
          text-align: center;
          background: linear-gradient(135deg, 
              #009C3B 0%, 
              #FEDF00 50%, 
              #009C3B 100%);
          -webkit-background-clip: text;
          background-clip: text;
          color: transparent;
          text-shadow: 
              2px 2px 4px rgba(0, 0, 0, 0.3),
              0 0 10px rgba(254, 223, 0, 0.4);
          transform: translateZ(20px);
          font-weight: bold;
          letter-spacing: 1px;
          position: relative;
          animation: float3d 6s ease-in-out infinite;
        }
        @keyframes float3d {
          0%, 100% { 
            transform: translateZ(20px) translateY(0) rotateX(0deg);
            text-shadow: 
              2px 2px 4px rgba(0, 0, 0, 0.3),
              0 0 10px rgba(254, 223, 0, 0.4),
              0 0 20px rgba(254, 223, 0, 0.2);
          }
          50% { 
            transform: translateZ(30px) translateY(-5px) rotateX(5deg);
            text-shadow: 
              4px 4px 8px rgba(0, 0, 0, 0.4),
              0 0 15px rgba(254, 223, 0, 0.6),
              0 0 30px rgba(254, 223, 0, 0.3);
          }
        }
        .subtitle {
          font-size: 18px;
          opacity: 0.9;
          background: linear-gradient(45deg,
                  #FEDF00 0%,
                  #009C3B 50%, 
                  #FEDF00 100%);
          -webkit-background-clip: text;
          background-clip: text;
          color: transparent;
          text-shadow:
              1px 1px 2px rgba(0, 0, 0, 0.2),
              0 0 8px rgba(0, 156, 59, 0.3);
          margin-top: 8px;
          animation: subtitleGlow 4s ease-in-out infinite alternate;
        }
        @keyframes subtitleGlow {
          0% { opacity: 0.8; }
          100% { opacity: 1; }
        }
        .card{
          background:linear-gradient(180deg, rgba(56,189,248,.06), rgba(56,189,248,0) 65%), var(--card);
          border:1px solid var(--border);
          border-radius:14px;
          padding:18px;
          box-shadow:var(--shadow);
          margin-bottom:18px;
        }
        .grid{
          display:grid;
          grid-template-columns:repeat(12,1fr);
          gap:12px;
        }
        .col-12{grid-column:span 12;}
        .col-6{grid-column:span 6;}
        .col-4{grid-column:span 4;}
        .col-3{grid-column:span 3;}
        @media (max-width: 800px){
          .col-6,.col-4,.col-3{grid-column:span 12;}
        }
        label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
        input[type="text"], input[type="date"], textarea, select{
          width:100%; background:var(--input); color:var(--text);
          border:1px solid var(--border); border-radius:10px; padding:10px 12px;
          outline:none; transition:border-color .2s, box-shadow .2s;
        }
        input[readonly]{opacity:.85}
        input:focus, textarea:focus, select:focus{
          border-color:var(--accent);
          box-shadow:0 0 0 3px rgba(56,189,248,.15);
        }
        textarea{min-height:88px; resize:vertical}
        .muted{color:var(--muted);font-size:13px}
        .row{
          display:flex; gap:10px; flex-wrap:wrap;
          align-items:center; justify-content:space-between;
          margin-bottom:8px;
        }
        .btn{
          appearance:none; border:1px solid var(--border);
          padding:10px 14px; border-radius:10px; cursor:pointer;
          color:var(--text); background:#0b1422; transition:transform .05s ease, background .2s, border-color .2s;
        }
        .btn:active{ transform:translateY(1px) }
        .btn-primary{ background:linear-gradient(180deg, rgba(34,197,94,.22), rgba(34,197,94,0) 50%), #0e1a12; border-color:#204a2f }
        .btn-primary:hover{ background:#0e2617; }
        .btn-accent{ background:linear-gradient(180deg, rgba(56,189,248,.22), rgba(56,189,248,0) 50%), #0b1422; border-color:#1e3a8a }
        .btn-accent:hover{ background:#0c192b }
        .btn-danger{ background:linear-gradient(180deg, rgba(239,68,68,.22), rgba(239,68,68,0) 50%), #1a0e10; border-color:#7f1d1d }
        .btn-danger:hover{ background:#260e12 }
        .pill{
          display:inline-flex; gap:8px; align-items:center; padding:6px 10px; border-radius:999px;
          font-size:12px; border:1px solid var(--border); background:#0b1422; color:var(--text);
          margin-top: 12px;
        }
        .error{ color:#fecaca; background:rgba(239,68,68,.08); border:1px solid rgba(239,68,68,.25); padding:8px 10px; border-radius:10px; }
        .success{ color:#bbf7d0; background:rgba(34,197,94,.08); border:1px solid rgba(34,197,94,.25); padding:8px 10px; border-radius:10px; }
        .warn{ color:#fde68a; background:rgba(245,158,11,.08); border:1px solid rgba(245,158,11,.25); padding:8px 10px; border-radius:10px; }
        .divider{ height:1px; background:var(--border); margin:12px 0; }
        table{ width:100%; border-collapse:collapse; font-size:14px; }
        th, td{ text-align:left; border-bottom:1px solid var(--border); padding:10px; vertical-align:top; }
        th{ color:var(--muted); font-weight:600; }
        .skeleton {
          background: linear-gradient(90deg, rgba(255,255,255,.04) 25%, rgba(255,255,255,.08) 50%, rgba(255,255,255,.04) 75%);
          background-size: 200% 100%;
          animation: shimmer 1.5s infinite;
          border-radius:8px; height:12px;
        }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
        .tag{display:inline-block;padding:2px 8px;border-radius:999px;background:#0e2238;border:1px solid #143255;color:#cfe9ff;font-size:12px}
        small.hint{color:#94a3b8}
        
        /* Estilos específicos para o sistema de férias */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background-color: var(--primary);
            color: white;
            border-radius: 4px;
            box-shadow: var(--shadow);
            opacity: 0;
            transform: translateY(-20px);
            transition: opacity 0.3s, transform 0.3s;
            z-index: 1000;
            max-width: 400px;
            word-wrap: break-word;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .notification.error {
            background-color: var(--danger);
        }

        .notification.warning {
            background-color: var(--warning);
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .action-buttons button {
            flex: 1;
        }
        
        .employee-select-container {
            display: flex;
            gap: 15px;
        }
        
        .employee-select-container > div {
            flex: 1;
        }
        
        .period-container {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        .period-container > div {
            flex: 1;
        }
        
        .days-info {
            text-align: center;
            padding: 10px;
            background-color: var(--input);
            border-radius: 10px;
            margin-top: 10px;
            font-weight: 600;
            border: 1px solid var(--border);
        }
        
        .days-info span {
            color: var(--accent);
            font-size: 18px;
        }

        /* Estilos para a tabela de lançamentos */
        .employee-list {
            margin-top: 30px;
        }
        
        .employee-list h2 {
            margin-bottom: 15px;
            color: var(--text);
            border-bottom: 1px solid var(--border);
            padding-bottom: 5px;
        }
        
        .table-responsive {
            overflow-x: auto;
            max-width: 100%;
        }

        .debug-info {
            background-color: var(--input);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        @media (max-width: 768px) {
            .period-container, .action-buttons, .employee-select-container {
                flex-direction: column;
            }
            
            h1 {
                font-size: 26px;
            }
            
            .subtitle {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>SISTEMA DE FÉRIAS E LICENÇA-PRÊMIO</h1>
            <div class="subtitle">SETOR: RADIOLOGIA</div>
            <div class="pill">
                <span style="width:10px;height:10px;border-radius:50%;background:var(--primary)"></span>
                Status: Sistema Ativo
            </div>
        </header>
        
        <!-- INÍCIO DO FORMULÁRIO -->
        <section class="card" aria-labelledby="titulo-form">
            <div class="row">
                <h2 id="titulo-form" style="margin:0;font-size:18px;">Cadastro de Férias/Licença Prêmio</h2>
            </div>

            <!-- Mensagens -->
            <div id="msg" role="status" aria-live="polite"></div>

            <form id="vacationForm" novalidate>
                <div class="grid">
                    <div class="col-6">
                        <label for="employeeSelect">Servidor</label>
                        <select id="employeeSelect"> 
                            <option value="">Selecione um servidor</option>
                            <!-- Opções serão preenchidas via JavaScript -->
                        </select>
                    </div>
                    <div class="col-6">
                        <label for="benefitType">Tipo de Benefício</label>
                        <select id="benefitType"> 
                            <option value="FÉRIAS">Férias</option>
                            <option value="LICENÇA PRÊMIO">Licença Prêmio</option>
                        </select>
                    </div>
                </div>

                <div class="divider"></div>

                <!-- Período Adquirido -->
                <div class="grid">
                    <div class="col-12">
                        <label for="acquiredPeriod">Período Adquirido</label>
                        <select id="acquiredPeriod">
                            <option value="">Selecione o período adquirido</option>
                            <option value="2020/2021">2020/2021</option>
                            <option value="2021/2022">2021/2022</option>
                            <option value="2022/2023">2022/2023</option>
                            <option value="2023/2024">2023/2024</option>
                            <option value="2024/2025">2024/2025</option>
                            <option value="2025/2026">2025/2026</option>
                        </select>
                        <small class="hint">Ano referente ao direito de férias do servidor</small>
                    </div>
                </div>

                <div class="divider"></div>

                <!-- 1º Período -->
                <h3 style="margin:6px 0 10px;font-size:16px;">1º Período</h3>
                <div class="grid">
                    <div class="col-6">
                        <label for="period1Start">Data Início</label>
                        <input type="date" id="period1Start">
                    </div>
                    <div class="col-6">
                        <label for="period1End">Data Término</label>
                        <input type="date" id="period1End">
                    </div>
                </div>
                <div class="days-info">Dias: <span id="period1Days">0</span></div>

                <div class="divider"></div>

                <!-- 2º Período -->
                <h3 style="margin:6px 0 10px;font-size:16px;">2º Período</h3>
                <div class="grid">
                    <div class="col-6">
                        <label for="period2Start">Data Início</label>
                        <input type="date" id="period2Start">
                    </div>
                    <div class="col-6">
                        <label for="period2End">Data Término</label>
                        <input type="date" id="period2End">
                    </div>
                </div>
                <div class="days-info">Dias: <span id="period2Days">0</span></div>

                <div class="divider"></div>

                <!-- Observações -->
                <div class="grid">
                    <div class="col-12">
                        <label for="observation">Observação</label>
                        <input type="text" id="observation" placeholder="Observações (opcional)">
                    </div>
                </div>

                <div class="action-buttons">
                    <button type="submit" class="btn btn-primary" id="saveBtn">Salvar Minha Escolha</button>
                    <button type="button" id="refreshBtn" class="btn btn-accent">Atualizar Lançamentos</button>
                    <button type="button" id="testBtn" class="btn">Testar Conexão</button>
                </div>
            </form>
        </section>

        <!-- NOTIFICAÇÃO (para feedback do usuário) -->
        <div class="notification" id="notification">Escolha salva com sucesso!</div>

        <!-- SEÇÃO PARA EXIBIR OS LANÇAMENTOS DO GOOGLE SHEETS -->
        <section class="card">
            <div class="row">
                <h2 style="margin:0;font-size:18px;">Lançamentos Registrados</h2>
            </div>
            <div class="table-responsive">
                <table id="choicesTable">
                    <thead>
                        <tr>
                            <th>Servidor</th>
                            <th>Cargo</th>
                            <th>Benefício</th>
                            <th>Período Adquirido</th>
                            <th>1º Período (Início)</th>
                            <th>1º Período (Fim)</th>
                            <th>Dias 1º P.</th>
                            <th>2º Período (Início)</th>
                            <th>2º Período (Fim)</th>
                            <th>Dias 2º P.</th>
                            <th>Observações</th>
                            <th>Registro</th>
                        </tr>
                    </thead>
                    <tbody id="choicesBody">
                        <tr><td colspan="12" style="text-align: center;">Carregando lançamentos...</td></tr>
                    </tbody>
                </table>
            </div>
        </section>
    </div>

    <script>
        // URL do seu Apps Script implantado (SUBSTITUA PELA SUA URL!)
        const APP_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyBXKmvM7l5cgkz4s-L8PrgSEEecTPkcH2amQJo_n4ttT42jzwGTyJRaZtcjYvYN06w/exec'; 

        const employees = [
            { id: 1, name: "ADONIAS SILVA DE FREITAS", position: "TEC. RADIOLOGIA" },
            { id: 2, name: "CARLOS ALBERTO CERQUEIRA SANTOS JUNIOR", position: "TEC. RADIOLOGIA" },
            { id: 3, name: "DANIELA DOS SANTOS SILVA", position: "TEC. RADIOLOGIA" },
            { id: 4, name: "DENISVAL RODRIGUES", position: "TEC. RADIOLOGIA" },
            { id: 5, name: "DIONY MOURÃO ARAÚJO", position: "TEC. RADIOLOGIA" },
            { id: 6, name: "GLENDA LUCIA FORO ANDRADE", position: "TEC. RADIOLOGIA" },
            { id: 7, name: "HEVERSON MOURÃO VIEIRA", position: "TEC. RADIOLOGIA" },
            { id: 8, name: "KELISSON ASSIS DE SOUSA", position: "TEC. RADIOLOGIA" },
            { id: 9, name: "LAIS DE SOUZA CARVALHO", position: "TEC. RADIOLOGIA" },
            { id: 10, name: "LUIS CARLOS DE SOUSA OLIVEIRA", position: "TEC. RADIOLOGIA" },
            { id: 11, name: "LUIZ HENRIQUE BARBOSA DE SOUSA", position: "TEC. RADIOLOGIA" },
            { id: 12, name: "MARCIA DA SILVA OLIVEIRA", position: "TEC. RADIOLOGIA" },
            { id: 13, name: "MARIANO MACIEL DOS PASSOS", position: "TEC. RADIOLOGIA" },
            { id: 14, name: "REDSON PEREIRA FEITOZA", position: "TEC. RADIOLOGIA" },
            { id: 15, name: "RODRIGO SANTANA MAIA", position: "TEC. RADIOLOGIA" },
            { id: 16, name: "ROQUE JOSE DE NOVAIS FILHO", position: "TEC. RADIOLOGIA" },
            { id: 17, name: "THIAGO RODRIGUES DE LIMA", position: "TEC. RADIOLOGIA" },
            { id: 18, name: "VALDECIR SILVA DOS SANTOS", position: "TEC. RADIOLOGIA" },
            { id: 19, name: "WANDERLEI ALVES DE FREITAS", position: "TEC. RADIOLOGIA" },
            { id: 20, name: "WILMARA PEREIRA DE OLIVEIRA", position: "TEC. RADIOLOGIA" }
        ];

        // Função para adicionar logs de debug
        function addDebugLog(message) {
            const debugInfo = document.getElementById('debugInfo');
            const timestamp = new Date().toLocaleTimeString();
            if (debugInfo) {
                debugInfo.innerHTML += `<br>[${timestamp}] ${message}`;
                debugInfo.scrollTop = debugInfo.scrollHeight;
            }
            console.log(`[${timestamp}] ${message}`);
        }

        // Mostrar notificação
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            if (notification) { 
                notification.textContent = message;
                notification.className = `notification ${type}`;
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 5000);
            }
            
            addDebugLog(`Notificação (${type}): ${message}`);
        }

        // Calcular dias entre duas datas
        function calculateDays(startDate, endDate) {
            if (!startDate || !endDate) return 0;
            
            const start = new Date(startDate + 'T00:00:00');
            const end = new Date(endDate + 'T00:00:00');
            
            if (isNaN(start.getTime()) || isNaN(end.getTime())) return 0;
            
            const diffTime = Math.abs(end.getTime() - start.getTime());
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
            
            return diffDays;
        }

        // Formatar data para exibição (DD/MM/AAAA)
        function formatDate(dateString) {
            if (!dateString) return '';
            
            const date = new Date(dateString); 
            if (isNaN(date.getTime())) return '';

            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            
            return `${day}/${month}/${year}`;
        }

        // Atualiza contagem de dias
        function updateDaysCount() {
            const period1Start = document.getElementById('period1Start').value;
            const period1End = document.getElementById('period1End').value;
            const period2Start = document.getElementById('period2Start').value;
            const period2End = document.getElementById('period2End').value;
            
            const days1 = calculateDays(period1Start, period1End);
            const days2 = calculateDays(period2Start, period2End);
            
            document.getElementById('period1Days').textContent = days1;
            document.getElementById('period2Days').textContent = days2;
        }

        // Preencher select de servidores
        function populateEmployeeSelect() {
            const employeeSelect = document.getElementById('employeeSelect');
            
            employees.forEach(employee => {
                const option = document.createElement('option');
                option.value = employee.name;
                option.textContent = employee.name;
                employeeSelect.appendChild(option);
            });
            
            addDebugLog(`${employees.length} servidores carregados no select`);
        }

        // Limpar o formulário após o envio
        function clearForm() {
            document.getElementById('employeeSelect').value = '';
            document.getElementById('benefitType').value = 'FÉRIAS';
            document.getElementById('acquiredPeriod').value = '';
            document.getElementById('period1Start').value = '';
            document.getElementById('period1End').value = '';
            document.getElementById('period2Start').value = '';
            document.getElementById('period2End').value = '';
            document.getElementById('observation').value = '';
            
            document.getElementById('period1Days').textContent = '0';
            document.getElementById('period2Days').textContent = '0';
            
            addDebugLog('Formulário limpo');
        }

        // Função para testar a conexão com o Apps Script
        async function testConnection() {
            addDebugLog('Iniciando teste de conexão...');
            
            try {
                const response = await fetch(APP_SCRIPT_URL, {
                    method: 'GET',
                    mode: 'cors'
                });
                
                addDebugLog(`Status da resposta: ${response.status}`);
                
                const data = await response.json();
                addDebugLog(`Dados recebidos: ${JSON.stringify(data)}`);
                
                if (data.status === 'success') {
                    showNotification('✅ Conexão com Apps Script funcionando!', 'success');
                } else {
                    showNotification('⚠️ Apps Script respondeu, mas com erro', 'warning');
                }
                
            } catch (error) {
                addDebugLog(`Erro na conexão: ${error.message}`);
                showNotification('❌ Erro de conexão com Apps Script', 'error');
            }
        }

        // FUNÇÃO CORRIGIDA PARA BUSCAR E RENDERIZAR OS LANÇAMENTOS DA PLANILHA
        async function fetchAndRenderChoices() {
            const choicesBody = document.getElementById('choicesBody');
            choicesBody.innerHTML = '<tr><td colspan="12" style="text-align: center;">Carregando lançamentos...</td></tr>';
            
            addDebugLog('Buscando lançamentos...');

            try {
                // CORREÇÃO: Usar o parâmetro correto que o Apps Script espera
                const url = APP_SCRIPT_URL + '?action=getRegistros';
                addDebugLog(`URL de busca: ${url}`);
                
                const response = await fetch(url);
                addDebugLog(`Status da busca: ${response.status}`);
                
                const result = await response.json();
                addDebugLog(`Resultado da busca: ${JSON.stringify(result)}`);

                // CORREÇÃO: Verificar o campo correto da resposta
                if (result.status === 'success') {
                    choicesBody.innerHTML = '';

                    if (result.data.length === 0) {
                        choicesBody.innerHTML = '<tr><td colspan="12" style="text-align: center;">Nenhum lançamento registrado ainda.</td></tr>';
                        addDebugLog('Nenhum lançamento encontrado');
                        return;
                    }

                    result.data.forEach((row, index) => {
                        const tr = document.createElement('tr');
                        
                        tr.innerHTML = `
                            <td>${row['Servidor'] || ''}</td>
                            <td>${row['Cargo'] || ''}</td>
                            <td>${row['Benefício'] || ''}</td>
                            <td>${row['Período Adquirido'] || ''}</td>
                            <td>${row['Data inicial do primeiro período'] || ''}</td>
                            <td>${row['Data final do primeiro período'] || ''}</td>
                            <td>${row['Dias do primeiro período'] || '0'}</td>
                            <td>${row['Data inicial do segundo período'] || ''}</td>
                            <td>${row['Data final do segundo período'] || ''}</td>
                            <td>${row['Dias do segundo período'] || '0'}</td>
                            <td>${row['Observações'] || ''}</td>
                            <td>${row['Hora e data do registro'] || ''}</td>
                        `;
                        choicesBody.appendChild(tr);
                    });
                    
                    addDebugLog(`${result.data.length} lançamentos carregados`);
                } else {
                    showNotification('Erro ao carregar lançamentos: ' + (result.message || 'Erro desconhecido'), 'error');
                    choicesBody.innerHTML = '<tr><td colspan="12" style="text-align: center; color: red;">Erro ao carregar lançamentos.</td></tr>';
                }

            } catch (error) {
                addDebugLog(`Erro ao buscar lançamentos: ${error.message}`);
                showNotification('Erro de rede ao carregar lançamentos', 'error');
                choicesBody.innerHTML = '<tr><td colspan="12" style="text-align: center; color: red;">Erro de conexão.</td></tr>';
            }
        }

        // Função para desabilitar/habilitar botões
        function setButtonsState(disabled) {
            document.getElementById('saveBtn').disabled = disabled;
            document.getElementById('refreshBtn').disabled = disabled;
            document.getElementById('testBtn').disabled = disabled;
        }

        // Inicializar a aplicação
        document.addEventListener('DOMContentLoaded', () => {
            addDebugLog('Sistema iniciado');
            addDebugLog(`URL do Apps Script: ${APP_SCRIPT_URL}`);
            
            populateEmployeeSelect();
            updateDaysCount();
            
            // Adicionar event listeners para cálculo de dias
            document.getElementById('period1Start').addEventListener('change', updateDaysCount);
            document.getElementById('period1End').addEventListener('change', updateDaysCount);
            document.getElementById('period2Start').addEventListener('change', updateDaysCount);
            document.getElementById('period2End').addEventListener('change', updateDaysCount);

            // Listener para o botão de teste
            document.getElementById('testBtn').addEventListener('click', testConnection);

            // Listener para o formulário
            document.getElementById('vacationForm').addEventListener('submit', async function(event) {
                event.preventDefault();
                
                addDebugLog('Iniciando envio do formulário...');
                setButtonsState(true);

                // Validações básicas
                const employeeSelect = document.getElementById('employeeSelect');
                const acquiredPeriod = document.getElementById('acquiredPeriod').value;
                const period1Start = document.getElementById('period1Start').value;
                const period1End = document.getElementById('period1End').value;
                const period2Start = document.getElementById('period2Start').value;
                const period2End = document.getElementById('period2End').value;

                if (!employeeSelect.value) {
                    showNotification('Por favor, selecione um servidor!', 'error');
                    setButtonsState(false);
                    return;
                }

                if (!acquiredPeriod) {
                    showNotification('Por favor, selecione o período adquirido!', 'error');
                    setButtonsState(false);
                    return;
                }

                if ((!period1Start || !period1End) && (!period2Start || !period2End)) {
                    showNotification('Por favor, preencha pelo menos um período!', 'error');
                    setButtonsState(false);
                    return;
                }
                
                const days1 = calculateDays(period1Start, period1End);
                const days2 = calculateDays(period2Start, period2End);

                if ((period1Start && period1End && days1 <= 0) || (period2Start && period2End && days2 <= 0)) {
                    showNotification('Datas inválidas! Verifique os períodos.', 'error');
                    setButtonsState(false);
                    return;
                }

                // Prepara os dados no formato FormData (como o Apps Script original espera)
                const formData = new FormData();
                formData.append('Servidor', employeeSelect.value);
                formData.append('Cargo do Funcionário', 'TEC. RADIOLOGIA');
                formData.append('Benefício', document.getElementById('benefitType').value);
                formData.append('Período Adquirido', acquiredPeriod);
                formData.append('Data inicial do primeiro período', period1Start || '');
                formData.append('Data final do primeiro período', period1End || '');
                formData.append('Dias do primeiro período', days1.toString());
                formData.append('Data inicial do segundo período', period2Start || '');
                formData.append('Data final do segundo período', period2End || '');
                formData.append('Dias do segundo período', days2.toString());
                formData.append('Observações', document.getElementById('observation').value || '');
                
                addDebugLog('Dados preparados para envio');
                
                try {
                    addDebugLog('Enviando requisição POST...');
                    
                    const response = await fetch(APP_SCRIPT_URL, {
                        method: 'POST',
                        body: formData
                    });
                    
                    addDebugLog(`Status da resposta: ${response.status}`);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const data = await response.json();
                    addDebugLog(`Resposta recebida: ${JSON.stringify(data)}`);

                    if (data.status === 'success') {
                        showNotification('✅ Escolha salva com sucesso!', 'success');
                        clearForm();
                        fetchAndRenderChoices();
                    } else {
                        showNotification(`❌ Erro: ${data.message}`, 'error');
                    }
                } catch (error) {
                    addDebugLog(`Erro na requisição: ${error.message}`);
                    showNotification(`❌ Erro de conexão: ${error.message}`, 'error');
                } finally {
                    setButtonsState(false);
                }
            });

            // Listener para o botão 'Atualizar Lançamentos'
            document.getElementById('refreshBtn').addEventListener('click', fetchAndRenderChoices);

            // Carrega os lançamentos ao iniciar a página
            fetchAndRenderChoices();
        });
    </script>
</body>
</html>